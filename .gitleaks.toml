# Gitleaks configuration for home-infra
# https://github.com/gitleaks/gitleaks

title = "gitleaks config for home-infra"

[extend]
# useDefault will extend the base configuration with the default gitleaks config
# https://github.com/gitleaks/gitleaks/blob/master/config/gitleaks.toml
useDefault = true

[[rules]]
id = "generic-api-key"
[[rules.allowlists]]
condition = "AND"
# Allow Sealed Secrets or similar large base64-encoded blobs (e.g., Kubernetes SealedSecret encrypted data)
regexes = ['''Ag[a-zA-Z0-9+/]{500,}={0,2}''']
paths = ['''(?i).*\.ya?ml$''']

# Allow encrypted secrets files managed by git-crypt
[[rules.allowlists]]
condition = "AND"
paths = [
  '''.*\.secrets\.auto\.tfvars$''',
  '''packer/.*/\.env$''',
  '''terraform/.*/\.env$''',
  '''backend\.config$'''
]

[[rules]]
id = "cloudflare-api-key"
[[rules.allowlists]]
condition = "AND"
# Allow encrypted secrets files managed by git-crypt
paths = [
  '''.*\.secrets\.auto\.tfvars$''',
  '''packer/.*/\.env$''',
  '''terraform/.*/\.env$''',
  '''backend\.config$'''
]

[[rules]]
id = "github-pat"
[[rules.allowlists]]
condition = "AND"
# Allow encrypted secrets files managed by git-crypt
paths = [
  '''.*\.secrets\.auto\.tfvars$''',
  '''packer/.*/\.env$''',
  '''terraform/.*/\.env$''',
  '''backend\.config$'''
]

[[rules]]
id = "private-key"
[[rules.allowlists]]
condition = "AND"
# Allow private keys stored in *.template files or encrypted secrets files managed by git-crypt
paths = [
  '''.*\.template$''',
  '''.*\.secrets\.auto\.tfvars$''',
  '''packer/.*/\.env$''',
  '''terraform/.*/\.env$''',
  '''backend\.config$'''
]
